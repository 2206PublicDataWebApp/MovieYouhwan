<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="StoreMapper">
	<resultMap type="Product" id="productResultMap">
		<id property="productNo" column="PRODUCT_NO" />
		<result property="productName" column="PRODUCT_NAME" />
		<result property="productType" column="PRODUCT_TYPE" />
		<result property="productPrice" column="PRODUCT_PRICE" />
		<result property="productDesc" column="PRODUCT_DESC" />
		<result property="productOrder" column="PRODUCT_ORDER" />
		<result property="productImgName" column="PRODUCT_IMG_NAME" />
		<result property="productImgRename" column="PRODUCT_IMG_RENAME" />
		<result property="productImgPath" column="PRODUCT_IMG_PATH" />
	</resultMap>
	<resultMap type="ProductType" id="productTypeResultMap">
		<id property="productTypeNo" column="PRODUCT_TYPE_NO" />
		<result property="productType" column="PRODUCT_TYPE" />
	</resultMap>
	<select id="selectProductList" resultMap="productResultMap">
		SELECT * FROM
		PRODUCT_TBL ORDER BY PRODUCT_ORDER ASC
	</select>
	<select id="selectProductTypeList"
		resultMap="productTypeResultMap">
		SELECT DISTINCT PRODUCT_TYPE_NO, PRODUCT_TYPE FROM
		PRODUCT_TYPE_TBL
		JOIN PRODUCT_TBL USING (PRODUCT_TYPE) ORDER BY
		PRODUCT_TYPE_NO ASC
	</select>
	<select id="selectProduct" resultMap="productResultMap">
		SELECT * FROM PRODUCT_TBL
		WHERE PRODUCT_NO = #{productNo}
	</select>
	<insert id="insertProduct">
		INSERT INTO PRODUCT_TBL
		VALUES(SEQ_PRODUCT_NO.NEXTVAL, #{productName}, #{productType},
		#{productPrice}, #{productDesc},
		(SELECT MAX(PRODUCT_ORDER) + 1 FROM PRODUCT_TBL),
		#{productImgName}, #{productImgRename}, #{productImgPath} )
	</insert>
	<delete id="deleteProduct">
		DELETE FROM PRODUCT_TBL WHERE PRODUCT_NO = #{productNo}
	</delete>
	<update id="updateProduct">
		UPDATE PRODUCT_TBL SET
		PRODUCT_NAME = #{productName}, PRODUCT_TYPE = #{productType},
		PRODUCT_PRICE = ${productPrice}, PRODUCT_DESC = #{productDesc},
		PRODUCT_IMG_NAME = #{productImgName}, PRODUCT_IMG_RENAME = #{productImgRename}, PRODUCT_IMG_PATH = #{productImgPath}
		WHERE PRODUCT_NO = #{productNo}
	</update>
	<update id="updateProductOrder" parameterType="list">
		<foreach collection="list" item="item" index="index" open="DECLARE BEGIN" separator=";" close="; END;">
		UPDATE PRODUCT_TBL SET PRODUCT_ORDER = #{index} WHERE PRODUCT_NO = #{item}
		</foreach>
	</update>
</mapper>